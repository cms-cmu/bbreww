config = {
    "default_dir": "CI_output",
    "analysis_container": "/cvmfs/unpacked.cern.ch/gitlab-registry.cern.ch/cms-cmu/coffea4bees:latest",
}

rule all:
    input: 
        f"{config['default_dir']}/analysis_test_cutflows/test_cutflow.yml",
        f"{config['default_dir']}/analysis_test_cutflows_mc/test_cutflow.yml",
        f"{config['default_dir']}/skimmer_analysis_test_cutflows/test_cutflow.yml",

rule analysis_test_data:
    output: 
        f"{config['default_dir']}/analysis_test_data/test.coffea"
    container: 
        config["analysis_container"]
    log: 
        f"{config['default_dir']}/analysis_test_data/analysis_test_data.log"
    shell:
        "source bbreww/scripts/analysis_test_data.sh --output-base {config[default_dir]} 2>&1 | tee {log}"

rule analysis_test_cutflows_data:
    input: 
        f"{config['default_dir']}/analysis_test_data/test.coffea"
    output: 
        f"{config['default_dir']}/analysis_test_cutflows_data/test_cutflow_data.yml"
    container: 
        config["analysis_container"]
    log: 
        f"{config['default_dir']}/analysis_test_cutflows/test_data_cutflow.log"
    shell:
        "source bbreww/scripts/analysis_test_cutflows_data.sh --output-base {config[default_dir]} 2>&1 | tee {log}"

rule analysis_test_mc:
    output: 
        f"{config['default_dir']}/analysis_test_mc/test.coffea"
    container: 
        config["analysis_container"]
    log: 
        f"{config['default_dir']}/analysis_test_mc/analysis_test.log"
    shell:
        "source bbreww/scripts/analysis_test_mc.sh --output-base {config[default_dir]} 2>&1 | tee {log}"

rule analysis_test_cutflows_mc:
    input: 
        f"{config['default_dir']}/analysis_test_mc/test.coffea"
    output: 
        f"{config['default_dir']}/analysis_test_cutflows_mc/test_cutflow.yml"
    container: 
        config["analysis_container"]
    log: 
        f"{config['default_dir']}/analysis_test_cutflows_mc/analysis_test_cutflows_mc.log"
    shell:
        "source bbreww/scripts/analysis_test_cutflows_mc.sh --output-base {config[default_dir]} 2>&1 | tee {log}"

rule skimmer_test:
    output: 
        f"{config['default_dir']}/skimmer_test/picoaod_datasets.yml"
    container: 
        config["analysis_container"]
    log: 
        f"{config['default_dir']}/skimmer_test/skimmer_test.log"
    shell:
        "source bbreww/scripts/skimmer_test.sh --output-base {config[default_dir]} 2>&1 | tee {log}"

rule skimmer_analysis_test:
    input:
        f"{config['default_dir']}/skimmer_test/picoaod_datasets.yml"
    output: 
        f"{config['default_dir']}/skimmer_analysis_test/test.coffea"
    container: 
        config["analysis_container"]
    log: 
        f"{config['default_dir']}/skimmer_analysis_test/skimmer_analysis_test.log"
    shell:
        "source bbreww/scripts/skimmer_analysis_test.sh --output-base {config[default_dir]} 2>&1 | tee {log}"

rule skimmer_analysis_test_cutflows:
    input:
        f"{config['default_dir']}/skimmer_analysis_test/test.coffea"
    output: 
        f"{config['default_dir']}/skimmer_analysis_test_cutflows/test_cutflow.yml"
    container: 
        config["analysis_container"]
    log: 
        f"{config['default_dir']}/skimmer_analysis_test_cutflows/skimmer_analysis_test_cutflows.log"
    shell:
        "source bbreww/scripts/skimmer_analysis_test_cutflows.sh --output-base {config[default_dir]} 2>&1 | tee {log}"